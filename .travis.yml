language: cpp
os:
  - osx
  - linux
osx_image: xcode7.2
sudo: required
dist: trusty

env:
  global:
  - secure: sPJ7vpSKQIThdlNbG1SjoVIOgVH3PgDXii9ajYA+PynodYf2jhy6oYOC6VqO1kFBGURI6mHvy7P5CT7urCyCuZ/jtpA8ANh+wykSkXOZJKDPNip8WMcLFYRPgGz1VOJOavIIVPeIeVc2lJ9LloETozuAZ/JThuPLwyjmZrbF+2qv5hJ2csbSGnICud8TKe/3svkZ9mDK6/rf4hVd632N8aOmDoCMCfkE/6qHb3HMuIF4/mK5DpXLVb+61DXbpm0E6ZoaqkZtu/Q0HCPufLRlB9uwpOpGwzR6D9NvbkFimMiOIoGc8CgxSzHmmV8nJNHw1O7Ha+PLS4W5fnfOwB9FNhHtqhP0ZM0nG6O1TfIHVMVPCPW/rXYgtx2P64/ZBbItWPm/tz1uGFVh1EqjRmhRCIWhbX8hjPOHPAYFv596wfkQxwo8xzzL9LzUWUWtXgf7L2yT9QtaiS/K3cp33LbhWWfNfIuaR1NcWfDwze+5nyDVCvr8t1nVAj8blz76PE/0lOiVaU8BnKbCDBpVAFWKir8DlP8nie0zutYizFP58LiMEo3akP5aFxc2w4Xwz15K2uSkbtAM/L3WtN6auSZG6sYrvQALxlqZeh7lRBjRAbMkY4+FcaL1F+vC5W0EQiuqQG/gedu+WtWFjc0xitacJvbKgrDTQ5Huk26aMW+Vlqk=
  - secure: AGjeq+b77ujskgYDMjBJqEKxMUS/NiYVmorRy085M3rQjWKMKIDLiv/we5k5gghP03e7xW3is06wyyxpgyM8xZTSr2CFxWvKAUYZIaaabJG/ozQVY9yRq6d/vzZjy+jWObV419zWsJ8zZssd9wW1zuZl/cE62BoYiEps6YEaPvBU9oI7HSxHflEWsWqCaD1V8D2qqHp8wcmfRG2+Oy5m5evrWuKfiFvKswsSWoOUnSPjuzY4l6RHsyZkf5k/l/HzEdip/4x1iPVXUegJMbbaEWPz3pv+XimQRgoICP4LjNU7+4Chp928ddCoII8pxTW+3Rong0PiVmDhedTUkJ2dwqbo/FzzPJjnhaFSlEyKaZP4dJJsaaYVeQK1/L3iB5lUg2H1olf3+md42prD+q/2aI08nQku9rJGI1W6yImOmpyNNaWISSDSyG7L6v7EBDzoD7SwsI5X1aY/W8XZzxoAwSI6cr+UYaieKbSI7kmlhoIVeaaZVl+YO/AAZCtj3Z/OqQHAu2nQYt82H4pdRLtlw7wd8gVKqIhJM9KfojGkeYFhF7U77rl5ZX7z2L/lXdH0XfGs+daXRhirkh1HZgynl8Df3DyJgnqULhID1XKSlwTTddTlg1xZlyqaQ7Ep4JaxBbegTTbfpwneLMZ1cTKBX4hgC5xLkvWmglsN3gkPhBs=
  - secure: k1iEhCygNoVevzzD9uHS0V3qjq/KMtDB2V7+10XKESaXSUoHJuuXsv6beh+d1rhSIjcj+tzv2Tt1L11LBbXvglV1tALsk5uEhKXuezx7hKwwfZoCzcf8ih1cso83z0KLJziSPIE6SguYeVuBU2rjJPK5A0QKp/hCGt5W1DxBKihfwLpLC27xcGqjmogt2TfjzdCo15kQ/RFd3Xtc/e0lKANDUhG0bIb2LD27wwvoYWcqhJSxWZq1W1Hb0DVjND4dcoAo4CEVnzHa4thmABq9RwNlHSAYog1eBic/H9Zjm6ZVmgUgwRu75ZWXBSXFt2e1xmVsIsE42VAsL0ycQK00lS5yUQeVqVXnTGlAPDEJjcAC9CxtdrAjw9928cCcLZ5fMY3HDKiuGD10njw/Wy03QNnfoNpxIllMTBDNpOPks9WpXjp88ySHyiW7NnsmXDqzGpTKNz1Z9jMFYGauuAOR91c2WUto4aok2o9JEjI/y5/X1bXl5UBYpeNnEoiKiwRxPeaXOJORtgniKDRnp1D94Zs5CVrd3AMfXj2M8rCIwcDLFex+I6zl7WISI94Uu2fXCH9uSaA7qavbwXPWpy8SrxbnQVYidn2wNO+IQsGH7vKYcn+8nPhNJW1pa9YN1+ESk71tJhk8SdstezjKOZepK3suKzt1Gl0d1guH16EYUKc=

cache:
  directories:
    - node_modules

addons:
  artifacts:
    paths: $(ls dist/*.zip | tr "\n" ":")
    target_paths: mozilla/tofino/builds

before_install: scripts/bootstrap.py
install:
  - nvm --version
  - nvm install 5.9
  - node --version
  - npm --version
  - npm install --progress false --depth 0

script:
  - npm test

after_success:
  - npm run package

notifications:
  slack:
    secure: Vc1nxyKmmhqd6z+Abfm0648gZB4U7nkV2tmMwtVQppJ39mNXn0pUK74Z8Ub4gXCyyj2Y0/JmsuqOVSeaABY16n5LuP6KD3WUKyF8PzjWKLe5d5uR+Y0WP8ZtA2AOL0VjZyVM6TtXsZpZKB7+e9VeoeMbU5V2AOSfzvsUmvNHldY4+KarT/QiiNTNBaXsNFoWs+wMKWxDWcV/97BzULS1CTBp0INK+fB6fCoUypS8rzqgUPEC1EmIPMbS72Hjz83QfEUd/O+DMeceDqzCTSHgwYFvivNAWfAeNNekWCfDW7z7q8SeduixTGTlIjtLAWbQD2anw3xgu+PHcJNbF1evIysDI3fn4JH4bHL7Tu5uCL77aIWKWY+0QZRXNnV6tza3nIFLDOEGw0yBc2+W8dKSERpaKbRZ5PyCFJ1v5AG7whtXajG6xelvfhCP1lK5FWmyrycNKdaxlG37xafXQZ4wGWt4Zj81zyywk+PwM1hWVw5kOKDVlOI34z3/tZFMCqzfwPcIC7L8X1TeWAhphbEfMa1PUi3WVawQqex36zogvLg6MW41NuEBXHykM3/3F0Ef11h09yiHhnVlYN/4s/R8FSydGBr3xG1o9Pn4C/YqvB2KBWPO4hp2/vng0yJi6uBE9sHR3p0sJ3WFQhboNfJDL8Ey6DWcxirQhHKlyvbbvpo=
    on_success: change
    on_failure: always
    on_pull_requests: false
