language: cpp
os:
  - osx
  - linux
osx_image: xcode7.2
sudo: required
dist: trusty

cache:
  directories:
    - node_modules

before_install: scripts/bootstrap.py
install:
  - nvm --version
  - nvm install 5.9
  - node --version
  - npm --version
  - npm install --progress false --depth 0

script:
  - npm test

after_success:
  - npm run package

notifications:
  slack:
    secure: Vc1nxyKmmhqd6z+Abfm0648gZB4U7nkV2tmMwtVQppJ39mNXn0pUK74Z8Ub4gXCyyj2Y0/JmsuqOVSeaABY16n5LuP6KD3WUKyF8PzjWKLe5d5uR+Y0WP8ZtA2AOL0VjZyVM6TtXsZpZKB7+e9VeoeMbU5V2AOSfzvsUmvNHldY4+KarT/QiiNTNBaXsNFoWs+wMKWxDWcV/97BzULS1CTBp0INK+fB6fCoUypS8rzqgUPEC1EmIPMbS72Hjz83QfEUd/O+DMeceDqzCTSHgwYFvivNAWfAeNNekWCfDW7z7q8SeduixTGTlIjtLAWbQD2anw3xgu+PHcJNbF1evIysDI3fn4JH4bHL7Tu5uCL77aIWKWY+0QZRXNnV6tza3nIFLDOEGw0yBc2+W8dKSERpaKbRZ5PyCFJ1v5AG7whtXajG6xelvfhCP1lK5FWmyrycNKdaxlG37xafXQZ4wGWt4Zj81zyywk+PwM1hWVw5kOKDVlOI34z3/tZFMCqzfwPcIC7L8X1TeWAhphbEfMa1PUi3WVawQqex36zogvLg6MW41NuEBXHykM3/3F0Ef11h09yiHhnVlYN/4s/R8FSydGBr3xG1o9Pn4C/YqvB2KBWPO4hp2/vng0yJi6uBE9sHR3p0sJ3WFQhboNfJDL8Ey6DWcxirQhHKlyvbbvpo=
    on_success: change
    on_failure: always
    on_pull_requests: false

deploy:
  provider: s3
  access_key_id:
    secure: G0nyVk9HHS+BAzbk/c02aEmRBF6p1kCDm7IZeAWFwigZMWuXm749F1iM/Rf+oH59kLr9+Fuih5+P84167vyzExjtYCSOzLQxH/R4i8ogf9bOjts4y9Qmm2dkAiEaDrTpfvzw8RNi6xb9w2bgL77AG2YhBpVPxEIn/rp2SVt9tsBWNGM+sDkCC/ElKrJB5YE+yjda4lvwL7PF+6ef4gzahDT6SjFAnkjMaT4EoP1DR2iycndziprSnoXMO/oqr6KrogAPZTKVHrg1b3V1OtkKu/4yttQPXZ/kdSYBFFGJr3uwDMhZ2Tv/yRjO5V4aO68SIrAqYhEkzG4SDVPUr3x4E6ZXk1fp98/esTSJlqFXsh7FYwinQEgmjAlli+Mht+blJte8wCo8jjF2Vm098Rd4IRGRYr6zF1Ecvc4AXLPGBcTlqeRUStFdZw/sowRWp4gUlbTN0zy06atdY6nDqwXEWq1U2UNzdxWzy/G0vOhCHWMBLG4Xx9im5tUhxqFSSn64h0y0xHJHmUJjSxaL8iatrdz+4rGcu2Sd6Fto0e3XYEWrnmNxRDQouUMYTY1FbwOt4tmJYq47LGMNaf5faqgXcCDnlSO7WMqcjHKCQdhjIsvkGZURlqXcGF5wh5XXF7nAIV15KyQbvpk+qriWFM31mmHW5beCScnd1I5S9gzxfgg=
  secret_access_key:
    secure: DE8ZtM8H7alA1R30XabMtZrP7yw8OMKInzaU70qq3awCzHDdXWfMj1hdc8gw/XsbR1kIqtykTrbdryg81pycrsmYnibep4rthoOWxAJhWcJDEFcPcdd0tV9iDWn6Ut6BGZBYE9MlDC7hv2okUhdtkkSvEXSQHXLOzIy2I8B4/nRAsdD3LxxirzsTW8z64HHU8yVscBNmWeWwnNgTRaDW/9RpfCZO74Qq1w0QjMd1zJ51LNhMxLOZyyHiHhVAhy6ZX+i6fEd17PMKU3kdzmXe7cOx6/nI/3iu8bHK2UlnICaKGx5buyIWjujTeKfdh7Q7cOfxvV3LspmUzrvGDb7AVU21TsELWDBecXW+likBTwyskRHbYGbMb9S0Xnb2cXN7mEwPVj46ajqAwhKZzrqWfBDoDHrCjgaQBRMZb8nBjuBm4YqN4hOB86yr4s3mLKPqLU9zkggo2tD6ActdWUAkhHr1wfz6eA1YAF6UasPr2iWC0Za1A7E9BiRJ4Bt9iaPb4DYRhhK8TODtpoBJxF+raZ3U3PDAjUnwVwlOoCY3ozhvIInyfAsK+U5EsQ50JjDXz8m3oRFffMPFxTBptAxBrurkYmSXnVBD/t5Z9kRSJ64Zg0yqlf0rBT6E1pS8DeYNwHPI8faIgQspikHJEcGv7tgQ85VtPYexJ/fQ0rq99C0=
  bucket:
    secure: FBDrdX5JtCsAldazyv68/13n1EyIOdB3EHO8sTQ3AwKYn04kbyI7dshdc56dHdaI1M4VLFXD1BOOHauGWilYXAKe+5k6R+Ivbasa4jYrUVPsDirqdHIP16VPv/AfeXoGqjHgPnm/FUNvGKAe8UukAYGlYZX1fLUDt0ShiioE2B7blK3yJCGJzUYZPJ1I3s5HdlKb6ug3QllP2Rf9qncAJfWRw2FINESYeG1i9EulZDvFb+/fmw5lnPdnobem9uGmq9H2kC8he4ADNIcYnXriFFBMXEJkIZXOiHkXihFTgXpY96WVNXOSw00SCKm02S6WXXiJvw579VxtP7FYBxQUEc992rHfk3WG6sdS+zpd/aJjwl4Z+QZbkvuoG76VKBQqPE6K7zzXOG2e2dWhqdq0IMsc8KC89GTyNJCOFAjYzyLh67Fdgzxi0+oiBtwYiV3mfZ8EvPBptYJZT6C0hk8b2xHAAKiqrhL78b7LIFAlAdH6owgofrtzoCB7glhQcqhYIxqASSwKkK82oDH16x+zDudE1Y074wX6K9TphXFqUEXBauQzblnfiU4vOYBpspc0Hf4Fr/3PY7VB9Ua3oPrdjU6K3ma8J8deeUhh6gaeS0IBnHd1zef7hO6up2sgtfQhOZdX4kHRgKTWgvUqPAMWTowf7NX+xDHeGYmcXXj3oc8=
  local-dir: dist
  upload-dir: mozilla/tofino/builds
  acl: public_read
  on:
    all_branches: true
